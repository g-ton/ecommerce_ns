function detallePedido(b){var a=$(this).data("fecha"),d=[],k=0;$.ajax({type:"POST",data:{idFolioPedido:b},url:window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/detallePedido",dataType:"json",encoding:"UTF-8",cache:!1,success:function(g){$("#order-list-detalle tbody tr").remove();$("#mensajeDetallePedido").html("<div class='box box-small clearfix'><p class='dark'><strong>Pedido con folio "+b+"- ha sido ordenado a "+a+"</strong></p></div>");$.each(g,function(a,c){var f=Math.floor(100*
Math.random()),h=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].insertRow(0),g=h.insertCell(0),l=h.insertCell(1),e=h.insertCell(2),m=h.insertCell(3),n=h.insertCell(4);h=h.insertCell(5);g.innerHTML=c.id_producto;l.innerHTML=c.descripcion;e.innerHTML=c.cantidad;m.innerHTML=c.precio_unitario;n.innerHTML=c.precio_unitario*c.cantidad;h.innerHTML="<a class='btnRmaForm btn btn-default button button-small' onclick=btnRmaForm('order-list-detalle',this) title='Solicitar RMA' id='"+
c.id_producto+f+"' data-idfoliopedido='"+b+"' data-refprod='"+c.id_producto+"' data-cantidad='"+c.cantidad+"'>Solicitar RMA</a>";d[k]=c.precio_unitario*c.cantidad;k++});g=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0];var f=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;f=g.insertRow(f);g=f.insertCell(0);f=f.insertCell(1);for(var l=0,e=0;e<d.length;e++)l+=d[e];g.innerHTML="<b>Total</b>";g.colSpan=1;f.innerHTML=
l;f.colSpan=4},error:function(b,d,a){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}
function btnRmaForm(b,a){$(a).attr("disabled",!0);var d=$(a).data("idfoliopedido"),k=$(a).data("refprod"),g=$(a).data("cantidad"),f=$(a);$.ajax({type:"POST",data:{idFolioPedido:d,referencia:k,tabla:b},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/consultarNserie",dataType:"json",encoding:"UTF-8",cache:!1,success:function(a){"undefined"!==typeof a.m?alert(a.m):$.each(a,function(a,m){var c=f.parent().parent().index(),e=document.getElementById(b).getElementsByTagName("tbody")[0].insertRow(c+
1);e.id=k+c;uniqId=d+""+c+a;uniqIdCheck=d+""+c+a+"check";c=e.insertCell(0);var h=e.insertCell(1),l=e.insertCell(2);e=e.insertCell(3);c.innerHTML="N. Serie: <input type='text' class='"+uniqId+" form-control n' name='nserie' value='"+m.num_serie+"' readonly>";h.innerHTML="Motivo: <input type='text' class='"+uniqId+" form-control m' name='motivo'>";h.colSpan=3;l.innerHTML="<input id='"+uniqIdCheck+"' type='checkbox' name='vehicle' value='rmaCheck'>";e.innerHTML="<input onclick='btnRmaEnviar(this)' type='button' value='Enviar' id='"+
uniqId+"' data-idfoliopedido='"+d+"' data-referencia='"+k+"' data-cantidad='"+g+"' data-idfoliopedidoweb='"+m.folio_pedido+"' data-foliocompra='"+m.folio_compra+"'>"})},error:function(a,b,d){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}
function btnRmaEnviar(b){var a=$(b).attr("id"),d="#"+$(b).attr("id")+"check";if($(d).is(":checked")){var k="."+a+".form-control.m";if(""!=$(k).val()){d=$(b).data("idfoliopedido");var g=$(b).data("referencia"),f=$(b).data("cantidad"),l=$(b).data("idfoliopedidoweb"),e=$(b).data("foliocompra"),m=$(b);uniqIdNserie="."+a+".form-control.n";b=$(uniqIdNserie).val();a=$(k).val();$.ajax({type:"POST",data:{cliente:clienteIdPrestashop,idFolioPedido:d,referencia:g,valNserie:b,valMotivo:a,cantidad:f,idfoliopedidoweb:l,
foliocompra:e},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/solicitarRma",dataType:"json",encoding:"UTF-8",cache:!1,beforeSend:function(){$(".loadingmessage").show()},success:function(a){$(".loadingmessage").hide();alert(a.m);m.attr("disabled",!0)},error:function(a,b,d){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}else alert("El campo motivo es requerido")}else alert("Debe habilitar el cuadro de selecci\u00f3n para poder enviar el RMA")}
$(document).ready(function(){$(".btnFancyLinea").fancybox({autoSize:!1});$(".btnFancyPiso").fancybox({autoSize:!1});clienteIdPrestashop=$("#id_cliente").attr("value");var b=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasPiso";jsGrid.locale("es");$("#pedidos_piso").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(a){return $.ajax({type:"POST",dataType:"json",url:b,
data:{datos:a,cliente:clienteIdPrestashop}})}},fields:[{name:"pd-folio_pedido",type:"text",title:"Folio Pedido"},{name:"pd-fecha",type:"date_type",title:"Fecha"},{name:"pd-surtido",type:"text",title:"Estado"},{name:"fp-folio_factura_electronica",type:"text",title:"No. Factura"},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]});
var a=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasLinea";$("#pedidos_enlinea").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(b){return $.ajax({type:"POST",dataType:"json",url:a,data:{datos:b,cliente:clienteIdPrestashop}})}},fields:[{name:"o-reference",type:"text",title:"Folio Pedido"},{name:"o-date_add",type:"date_type",title:"Fecha"},{name:"o-payment",type:"text",
title:"Pago"},{name:"estado",type:"text",title:"Estado",width:250,filtering:!1},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"ordenar",type:"text",title:"Ordenar",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]})});