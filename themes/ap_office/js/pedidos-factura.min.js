$(document).ready(function(){var e="{$cliente}";setTimeout(function(){$.ajax({type:"POST",data:{cliente:e},url:window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasPiso",dataType:"json",encoding:"UTF-8",cache:!1,success:function(e){$.each(e,function(e,i){var t=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/descargarFactura&file="+i.folio_factura_electronica,a=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/descargarFacturaXml&file="+i.folio_factura_electronica,n=document.getElementById("order-list-enpiso").getElementsByTagName("tbody")[0],o=n.insertRow(0),r=o.insertCell(0),d=o.insertCell(1),l=o.insertCell(2),c=o.insertCell(3),s=o.insertCell(4),u=o.insertCell(5);r.innerHTML="<a class='btnDetallePedido' target='_blank' title='Ver Detalle' id='"+i.folio_pedido+"' data-fecha='"+i.fecha+"'>"+i.folio_pedido+"</a>",d.innerHTML=i.fecha,l.innerHTML=i.tipo_pago,"S"==i.surtido?c.innerHTML="Surtido":c.innerHTML="-",s.innerHTML="<a class='link-button' target='_blank' title='Invoice' href='"+t+"'><i class='icon-file-text'></i>PDF</a>",u.innerHTML="<a class='link-button' target='_blank' title='Invoice' href='"+a+"'><i class='icon-file-text'></i>XML</a>"}),$.trim(e)||$("#sinPedidoPiso").html("<p class='alert alert-warning'>No tiene ning&uacute;n pedido en piso</p>"),$(document).trigger("lanzadorDetallePedido")},error:function(e,i,t){}})},1500);var i=0;setTimeout(function(){$.ajax({type:"POST",data:{cliente:e},url:window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasLinea",dataType:"json",encoding:"UTF-8",cache:!1,success:function(e){$.each(e,function(e,t){var a=document.getElementById("order-list-enpiso1").getElementsByTagName("tbody")[0].getElementsByTagName("tr")[i],n=document.getElementById("order-list-enpiso1").getElementsByTagName("tbody")[0].getElementsByTagName("tr")[i].getElementsByTagName("td"),o=n.length+1,r=a.insertCell(n.length),d=a.insertCell(o);if("-"!=t.folio_factura_electronica){var l=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/descargarFactura&file="+t.folio_factura_electronica;r.innerHTML="<a class='link-button' target='_blank' title='Invoice' href='"+l+"'><i class='icon-file-text'></i>PDF</a>"}else r.innerHTML=t.folio_factura_electronica;if("-"!=t.folio_factura_electronica){var l=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/descargarFacturaXml&file="+t.folio_factura_electronica;d.innerHTML="<a class='link-button' target='_blank' title='Invoice' href='"+l+"'><i class='icon-file-text'></i>XML</a>"}else d.innerHTML=t.folio_factura_electronica;i++})},error:function(e,i,t){}})},1500),$(document).on("lanzadorDetallePedido",function(e){$(".btnDetallePedido").click(function(){var e=$(this).attr("id"),i=$(this).data("fecha"),t=new Array,a=0;$.ajax({type:"POST",data:{idFolioPedido:e},url:window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/detallePedido",dataType:"json",encoding:"UTF-8",cache:!1,success:function(n){$("#order-list-detalle tbody tr").remove(),$("#divDetallePedido").fadeIn(1500,function(){$("#mensajeDetallePedido").html("<div class='box box-small clearfix'><p class='dark'><strong>Pedido con folio "+e+"- ha sido ordenado a "+i+"</strong></p></div>"),$.each(n,function(i,n){var o=Math.floor(100*Math.random()),r=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0],d=r.insertRow(0),l=d.insertCell(0),c=d.insertCell(1),s=d.insertCell(2),u=d.insertCell(3),m=d.insertCell(4),f=d.insertCell(5);l.innerHTML=n.id_producto,c.innerHTML=n.descripcion,s.innerHTML=n.cantidad,u.innerHTML=n.precio_unitario,m.innerHTML=n.precio_unitario*n.cantidad,f.innerHTML="<a class='btnRmaForm btn btn-default button button-small' target='_blank' title='Solicitar RMA' id='"+n.id_producto+o+"' data-idfoliopedido='"+e+"' data-refprod='"+n.id_producto+"' data-cantidad='"+n.cantidad+"'>Solicitar RMA</a>",t[a]=n.precio_unitario*n.cantidad,a++});for(var o=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0],r=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].getElementsByTagName("tr").length,d=o.insertRow(r),l=d.insertCell(0),c=d.insertCell(1),s=0,u=0;u<t.length;u++)s+=t[u];l.innerHTML="<b>Total</b>",l.colSpan=1,c.innerHTML=s,c.colSpan=4,$(this).fadeIn("slow",function(){$.scrollTo(this,1e3)})})},complete:function(){var e="order-list-detalle";$(document).trigger("lanzadorRmaForm",[e])},error:function(e,i,t){}})})}),$(document).on("lanzadorRmaFormLinea",function(e,i){var t="#order-list-enpiso1 #"+i+"web",a=$(t).data("foliopedido");$.ajax({type:"POST",data:{idorder:i},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/consultarPedidosLinea",dataType:"json",encoding:"UTF-8",cache:!1,success:function(e){$.each(e,function(e,i){var t=Math.floor(100*Math.random()),n=document.getElementById("order-detail-content").getElementsByTagName("tbody")[0].getElementsByTagName("tr")[e],o=document.getElementById("order-detail-content").getElementsByTagName("tbody")[0].getElementsByTagName("tr")[e].getElementsByTagName("td"),r=n.insertCell(o.length);r.innerHTML="<a class='btnRmaForm btn btn-default button button-small' target='_blank' title='Solicitar RMA' id='"+i.product_reference+t+"' data-idfoliopedido='"+a+"' data-refprod='"+i.product_reference+"' data-cantidad='"+i.product_quantity+"'>Solicitar RMA</a>"})},complete:function(){var e="order-detail-content";$(document).trigger("lanzadorRmaForm",[e])},error:function(e,i,t){}})}),$(document).on("lanzadorRmaForm",function(e,i){setTimeout(function(){$(".btnRmaForm").click(function(){$(this).attr("disabled",!0);var e=$(this).data("idfoliopedido"),t=$(this).data("refprod"),a=$(this).data("cantidad"),n=$(this);$.ajax({type:"POST",data:{idFolioPedido:e,referencia:t,tabla:i},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/consultarNserie",dataType:"json",encoding:"UTF-8",cache:!1,success:function(o){"undefined"!=typeof o.m?alert(o.m):$.each(o,function(o,r){var d=n.parent().parent().index(),l=document.getElementById(i).getElementsByTagName("tbody")[0],c=l.insertRow(d+1);c.id=t+d,uniqId=e+""+d+o,uniqIdCheck=e+""+d+o+"check";var s=c.insertCell(0),u=c.insertCell(1),m=c.insertCell(2),f=c.insertCell(3);s.innerHTML="N. Serie: <input type='text' class='"+uniqId+" form-control n' name='nserie' value='"+r.num_serie+"' readonly>",u.innerHTML="Motivo: <input type='text' class='"+uniqId+" form-control m' name='motivo'>",u.colSpan=3,m.innerHTML="<input id='"+uniqIdCheck+"' type='checkbox' name='vehicle' value='rmaCheck'>",f.innerHTML="<input class='btnRmaEnviar' type='button' value='Enviar' id='"+uniqId+"' data-idfoliopedido='"+e+"' data-referencia='"+t+"' data-cantidad='"+a+"' data-idfoliopedidoweb='"+r.folio_pedido+"' data-foliocompra='"+r.folio_compra+"'>"})},error:function(e,i,t){}}),$(document).trigger("lanzadorRmaFormEnviar")})},1600)}),$(document).on("lanzadorRmaFormEnviar",function(e){$(document).off("click").on("click",".btnRmaEnviar",function(e){var i=$(this).attr("id"),t="#"+$(this).attr("id")+"check";if($(t).is(":checked")){var a="."+i+".form-control.m";if(""!=$(a).val()){var n="{$cliente}",o=$(this).data("idfoliopedido"),r=$(this).data("referencia"),d=$(this).data("cantidad"),l=$(this).data("idfoliopedidoweb"),c=$(this).data("foliocompra"),s=$(this);uniqIdNserie="."+i+".form-control.n";var u=$(uniqIdNserie).val(),m=$(a).val();$.ajax({type:"POST",data:{cliente:n,idFolioPedido:o,referencia:r,valNserie:u,valMotivo:m,cantidad:d,idfoliopedidoweb:l,foliocompra:c},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/solicitarRma",dataType:"json",encoding:"UTF-8",cache:!1,beforeSend:function(){$(".loadingmessage").show()},success:function(e){$(".loadingmessage").hide(),alert(e.m),s.attr("disabled",!0)},error:function(e,i,t){}})}else alert("El campo motivo es requerido")}else alert("Debe habilitar el cuadro de selecci√≥n para poder enviar el RMA")})})});