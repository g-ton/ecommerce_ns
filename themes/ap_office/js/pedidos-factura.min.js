function detallePedido(d){var b=$(this).data("fecha"),c=[],k=0;$.ajax({type:"POST",data:{idFolioPedido:d},url:window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/detallePedido",dataType:"json",encoding:"UTF-8",cache:!1,success:function(a){$("#order-list-detalle tbody tr").remove();$("#mensajeDetallePedido").html("<div class='box box-small clearfix'><p class='dark'><strong>Pedido con folio "+d+"- ha sido ordenado a "+b+"</strong></p></div>");$.each(a,function(b,a){var g=Math.floor(100*
Math.random()),e=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].insertRow(0),l=e.insertCell(0),f=e.insertCell(1),h=e.insertCell(2),m=e.insertCell(3),n=e.insertCell(4);e=e.insertCell(5);l.innerHTML=a.id_producto;f.innerHTML=a.descripcion;h.innerHTML=a.cantidad;m.innerHTML=a.precio_unitario;n.innerHTML=a.precio_unitario*a.cantidad;e.innerHTML="<a class='btnRmaForm btn btn-default button button-small' onclick=btnRmaForm('order-list-detalle',this) title='Solicitar RMA' id='"+
a.id_producto+g+"' data-idfoliopedido='"+d+"' data-refprod='"+a.id_producto+"' data-cantidad='"+a.cantidad+"'>Solicitar RMA</a>";c[k]=a.precio_unitario*a.cantidad;k++});a=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0];var g=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;g=a.insertRow(g);a=g.insertCell(0);g=g.insertCell(1);for(var f=0,h=0;h<c.length;h++)f+=c[h];a.innerHTML="<b>Total</b>";a.colSpan=1;g.innerHTML=
f;g.colSpan=4},error:function(a,b,c){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}
function btnRmaForm(d,b){$(b).attr("disabled",!0);var c=$(b).data("idfoliopedido"),k=$(b).data("refprod"),a=$(b).data("cantidad"),g=$(b);if("undefined"!==typeof $(b).data("num_serie")){var f=$(b).data("num_serie"),h=$(b).data("folio_compra");uniqId=c;uniqIdCheck=c+"check";f="<div class=\"form-group\">\n\t\t\tN. Serie: <input type='text' class='"+uniqId+" form-control n' name='nserie' value="+f+" readonly>\n\t\t</div>\n\t\t<div class=\"form-group\">\n\t\t\tMotivo: <input type='text' class='"+uniqId+
" form-control m' name='motivo'>\n\t\t</div>\n\t\t<div class=\"form-group\">\n\t\t\t<label>Cuadro de selecci\u00f3n RMA</label>\n\t\t\t<input id="+uniqIdCheck+" type='checkbox' value='rmaCheck'>\n\t\t\t<input onclick='btnRmaEnviar(this,1)' type='button' value='Enviar' id="+uniqId+" \n\t\t\tdata-idfoliopedido="+c+" \n\t\t\tdata-referencia="+k+" \n\t\t\tdata-cantidad="+a+" \n\t\t\tdata-foliocompra="+h+"\n\t\t\tdata-idfoliopedidoweb='undefined' \n\t\t\t>\n\t\t</div>";$("#verificar_adquirido").html(f)}else $.ajax({type:"POST",
data:{idFolioPedido:c,referencia:k,tabla:d},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/consultarNserie",dataType:"json",encoding:"UTF-8",cache:!1,success:function(b){"undefined"!==typeof b.m?alert(b.m):$.each(b,function(b,f){var e=g.parent().parent().index(),l=document.getElementById(d).getElementsByTagName("tbody")[0].insertRow(e+1);l.id=k+e;uniqId=c+""+e+b;uniqIdCheck=c+""+e+b+"check";e=l.insertCell(0);var h=l.insertCell(1),m=l.insertCell(2);l=l.insertCell(3);e.innerHTML="N. Serie: <input type='text' class='"+
uniqId+" form-control n' name='nserie' value='"+f.num_serie+"' readonly>";h.innerHTML="Motivo: <input type='text' class='"+uniqId+" form-control m' name='motivo'>";h.colSpan=3;m.innerHTML="<input id='"+uniqIdCheck+"' type='checkbox' name='vehicle' value='rmaCheck'>";l.innerHTML="<input onclick='btnRmaEnviar(this)' type='button' value='Enviar' id='"+uniqId+"' data-idfoliopedido='"+c+"' data-referencia='"+k+"' data-cantidad='"+a+"' data-idfoliopedidoweb='"+f.folio_pedido+"' data-foliocompra='"+f.folio_compra+
"'>"})},error:function(a,b,c){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}
function btnRmaEnviar(d,b){b=void 0===b?0:b;var c=$(d).attr("id"),k="#"+$(d).attr("id")+"check";if($(k).is(":checked")){var a="."+c+".form-control.m";if(""!=$(a).val()){k=$(d).data("idfoliopedido");var g=$(d).data("referencia"),f=$(d).data("cantidad"),h=$(d).data("idfoliopedidoweb"),m=$(d).data("foliocompra"),n=$(d);uniqIdNserie="."+c+".form-control.n";c=$(uniqIdNserie).val();a=$(a).val();$.ajax({type:"POST",data:{cliente:clienteIdPrestashop,idFolioPedido:k,referencia:g,valNserie:c,valMotivo:a,cantidad:f,
idfoliopedidoweb:h,foliocompra:m},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/solicitarRma",dataType:"json",encoding:"UTF-8",cache:!1,beforeSend:function(){0==b&&$(".loadingmessage").show()},success:function(a){0==b?($(".loadingmessage").hide(),n.attr("disabled",!0)):$("#verificar_adquirido").html("");alert(a.m)},error:function(a,c,d){0==b?$(".loadingmessage").hide():$("#verificar_adquirido").html("");alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}else alert("El campo motivo es requerido")}else alert("Debe habilitar el cuadro de selecci\u00f3n para poder enviar el RMA")}
$(document).ready(function(){$(".btnFancyLinea").fancybox({autoSize:!1});$(".btnFancyPiso").fancybox({autoSize:!1});clienteIdPrestashop=$("#id_cliente").attr("value");var d=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasPiso";jsGrid.locale("es");$("#pedidos_piso").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(b){return $.ajax({type:"POST",dataType:"json",url:d,
data:{datos:b,cliente:clienteIdPrestashop}})}},fields:[{name:"pd-folio_pedido",type:"text",title:"Folio Pedido"},{name:"pd-fecha",type:"date_type",title:"Fecha"},{name:"pd-surtido",type:"text",title:"Estado"},{name:"fp-folio_factura_electronica",type:"text",title:"No. Factura"},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]});
var b=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasLinea";$("#pedidos_enlinea").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(c){return $.ajax({type:"POST",dataType:"json",url:b,data:{datos:c,cliente:clienteIdPrestashop}})}},fields:[{name:"o-reference",type:"text",title:"Folio Pedido"},{name:"o-date_add",type:"date_type",title:"Fecha"},{name:"o-payment",type:"text",
title:"Pago"},{name:"estado",type:"text",title:"Estado",width:250,filtering:!1},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"ordenar",type:"text",title:"Ordenar",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]});var c=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarProductoPorNumSerie";$("#adquirido_con_ns").jsGrid({height:"auto",
width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(b){return $.ajax({type:"POST",dataType:"json",url:c,data:{datos:b,cliente:clienteIdPrestashop},success:function(a){a.mensaje&&alert(a.mensaje)}})}},fields:[{name:"a-num_serie",type:"text",title:"N\u00famero de Serie"},{name:"a-id_producto",type:"text",title:"ID Producto",filtering:!1},{name:"a-descripcion",type:"text",title:"Descripci\u00f3n",filtering:!1},{name:"solicitar_rma",type:"text",
title:"RMA",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]})});