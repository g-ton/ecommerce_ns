function detallePedido(b){var a=$(this).data("fecha"),d=[],l=0;$.ajax({type:"POST",data:{idFolioPedido:b},url:window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/detallePedido",dataType:"json",encoding:"UTF-8",cache:!1,success:function(g){$("#order-list-detalle tbody tr").remove();$("#mensajeDetallePedido").html("<div class='box box-small clearfix'><p class='dark'><strong>Pedido con folio "+b+"- ha sido ordenado a "+a+"</strong></p></div>");$.each(g,function(a,c){var g=Math.floor(100*
Math.random()),e=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].insertRow(0),h=e.insertCell(0),f=e.insertCell(1),k=e.insertCell(2),m=e.insertCell(3),n=e.insertCell(4);e=e.insertCell(5);h.innerHTML=c.id_producto;f.innerHTML=c.descripcion;k.innerHTML=c.cantidad;m.innerHTML=c.precio_unitario;n.innerHTML=c.precio_unitario*c.cantidad;e.innerHTML="<a class='btnRmaForm btn btn-default button button-small' onclick=btnRmaForm('order-list-detalle',this) title='Solicitar RMA' id='"+
c.id_producto+g+"' data-idfoliopedido='"+b+"' data-refprod='"+c.id_producto+"' data-cantidad='"+c.cantidad+"'>Solicitar RMA</a>";d[l]=c.precio_unitario*c.cantidad;l++});g=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0];var h=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].getElementsByTagName("tr").length;h=g.insertRow(h);g=h.insertCell(0);h=h.insertCell(1);for(var f=0,k=0;k<d.length;k++)f+=d[k];g.innerHTML="<b>Total</b>";g.colSpan=1;h.innerHTML=
f;h.colSpan=4},error:function(b,a,d){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}
function btnRmaForm(b,a){$(a).attr("disabled",!0);var d=$(a).data("idfoliopedido"),l=$(a).data("refprod"),g=$(a).data("cantidad"),h=$(a);if("undefined"!==typeof $(a).data("num_serie")){var f=$(a).data("num_serie"),k=$(a).data("folio_compra");uniqId=d;uniqIdCheck=d+"check";f="\n\t    <table style=\"width: 100%;\">\n\t\t\t<tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>N. Serie: <input type='text' class='"+uniqId+" form-control n' name='nserie' value="+f+" readonly></td>\n\t\t\t\t\t<td>Motivo: <input type='text' class='"+
uniqId+" form-control m' name='motivo'></td>\n\t\t\t\t\t<td><input id="+uniqIdCheck+" type='checkbox' value='rmaCheck'></td>\n\t\t\t\t\t<td><input onclick='btnRmaEnviar(this)' type='button' value='Enviar' id="+uniqId+" \n\t\t\t\t\t\tdata-idfoliopedido="+d+" \n\t\t\t\t\t\tdata-referencia="+l+" \n\t\t\t\t\t\tdata-cantidad="+g+" \n\t\t\t\t\t\tdata-foliocompra="+k+"\n\t\t\t\t\t\tdata-idfoliopedidoweb='undefined' \n\t\t\t\t\t\t>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>";$("#verificar_adquirido").html(f)}else $.ajax({type:"POST",
data:{idFolioPedido:d,referencia:l,tabla:b},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/consultarNserie",dataType:"json",encoding:"UTF-8",cache:!1,success:function(a){"undefined"!==typeof a.m?alert(a.m):$.each(a,function(a,f){var e=h.parent().parent().index(),c=document.getElementById(b).getElementsByTagName("tbody")[0].insertRow(e+1);c.id=l+e;uniqId=d+""+e+a;uniqIdCheck=d+""+e+a+"check";e=c.insertCell(0);var k=c.insertCell(1),m=c.insertCell(2);c=c.insertCell(3);e.innerHTML="N. Serie: <input type='text' class='"+
uniqId+" form-control n' name='nserie' value='"+f.num_serie+"' readonly>";k.innerHTML="Motivo: <input type='text' class='"+uniqId+" form-control m' name='motivo'>";k.colSpan=3;m.innerHTML="<input id='"+uniqIdCheck+"' type='checkbox' name='vehicle' value='rmaCheck'>";c.innerHTML="<input onclick='btnRmaEnviar(this)' type='button' value='Enviar' id='"+uniqId+"' data-idfoliopedido='"+d+"' data-referencia='"+l+"' data-cantidad='"+g+"' data-idfoliopedidoweb='"+f.folio_pedido+"' data-foliocompra='"+f.folio_compra+
"'>"})},error:function(a,c,b){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}
function btnRmaEnviar(b){var a=$(b).attr("id"),d="#"+$(b).attr("id")+"check";if($(d).is(":checked")){var l="."+a+".form-control.m";if(""!=$(l).val()){d=$(b).data("idfoliopedido");var g=$(b).data("referencia"),h=$(b).data("cantidad"),f=$(b).data("idfoliopedidoweb"),k=$(b).data("foliocompra"),m=$(b);uniqIdNserie="."+a+".form-control.n";b=$(uniqIdNserie).val();a=$(l).val();$.ajax({type:"POST",data:{cliente:clienteIdPrestashop,idFolioPedido:d,referencia:g,valNserie:b,valMotivo:a,cantidad:h,idfoliopedidoweb:f,
foliocompra:k},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/solicitarRma",dataType:"json",encoding:"UTF-8",cache:!1,beforeSend:function(){$(".loadingmessage").show()},success:function(a){$(".loadingmessage").hide();alert(a.m);m.attr("disabled",!0)},error:function(a,b,d){alert("Ha ocurrido un error, intente m\u00e1s tarde")}})}else alert("El campo motivo es requerido")}else alert("Debe habilitar el cuadro de selecci\u00f3n para poder enviar el RMA")}
$(document).ready(function(){$(".btnFancyLinea").fancybox({autoSize:!1});$(".btnFancyPiso").fancybox({autoSize:!1});clienteIdPrestashop=$("#id_cliente").attr("value");var b=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasPiso";jsGrid.locale("es");$("#pedidos_piso").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(a){return $.ajax({type:"POST",dataType:"json",url:b,
data:{datos:a,cliente:clienteIdPrestashop}})}},fields:[{name:"pd-folio_pedido",type:"text",title:"Folio Pedido"},{name:"pd-fecha",type:"date_type",title:"Fecha"},{name:"pd-surtido",type:"text",title:"Estado"},{name:"fp-folio_factura_electronica",type:"text",title:"No. Factura"},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]});
var a=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasLinea";$("#pedidos_enlinea").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(b){return $.ajax({type:"POST",dataType:"json",url:a,data:{datos:b,cliente:clienteIdPrestashop}})}},fields:[{name:"o-reference",type:"text",title:"Folio Pedido"},{name:"o-date_add",type:"date_type",title:"Fecha"},{name:"o-payment",type:"text",
title:"Pago"},{name:"estado",type:"text",title:"Estado",width:250,filtering:!1},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"ordenar",type:"text",title:"Ordenar",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]});var d=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarProductoPorNumSerie";$("#adquirido_con_ns").jsGrid({height:"auto",
width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(a){return $.ajax({type:"POST",dataType:"json",url:d,data:{datos:a,cliente:clienteIdPrestashop},success:function(a){a.mensaje&&alert(a.mensaje)}})}},fields:[{name:"a-num_serie",type:"text",title:"N\u00famero de Serie"},{name:"a-id_producto",type:"text",title:"ID Producto",filtering:!1},{name:"a-descripcion",type:"text",title:"Descripci\u00f3n",filtering:!1},{name:"solicitar_rma",type:"text",
title:"RMA",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]})});