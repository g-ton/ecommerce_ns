function detallePedido(e){var t=e,a=$(this).data("fecha"),i=new Array,o=0;$.ajax({type:"POST",data:{idFolioPedido:t},url:window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/detallePedido",dataType:"json",encoding:"UTF-8",cache:!1,success:function(e){$("#order-list-detalle tbody tr").remove(),$("#mensajeDetallePedido").html("<div class='box box-small clearfix'><p class='dark'><strong>Pedido con folio "+t+"- ha sido ordenado a "+a+"</strong></p></div>"),$.each(e,function(e,a){var n=Math.floor(100*Math.random()),r=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0],d=r.insertRow(0),l=d.insertCell(0),c=d.insertCell(1),s=d.insertCell(2),p=d.insertCell(3),u=d.insertCell(4),m=d.insertCell(5);l.innerHTML=a.id_producto,c.innerHTML=a.descripcion,s.innerHTML=a.cantidad,p.innerHTML=a.precio_unitario,u.innerHTML=a.precio_unitario*a.cantidad;var f="order-list-detalle";m.innerHTML="<a class='btnRmaForm btn btn-default button button-small' onclick=btnRmaForm('"+f+"',this) title='Solicitar RMA' id='"+a.id_producto+n+"' data-idfoliopedido='"+t+"' data-refprod='"+a.id_producto+"' data-cantidad='"+a.cantidad+"'>Solicitar RMA</a>",i[o]=a.precio_unitario*a.cantidad,o++});for(var n=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0],r=document.getElementById("order-list-detalle").getElementsByTagName("tbody")[0].getElementsByTagName("tr").length,d=n.insertRow(r),l=d.insertCell(0),c=d.insertCell(1),s=0,p=0;p<i.length;p++)s+=i[p];l.innerHTML="<b>Total</b>",l.colSpan=1,c.innerHTML=s,c.colSpan=4},error:function(e,t,a){alert("Ha ocurrido un error, intente más tarde")}})}function btnRmaForm(e,t){$(t).attr("disabled",!0);var a=$(t).data("idfoliopedido"),i=$(t).data("refprod"),o=$(t).data("cantidad"),n=$(t);$.ajax({type:"POST",data:{idFolioPedido:a,referencia:i,tabla:e},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/consultarNserie",dataType:"json",encoding:"UTF-8",cache:!1,success:function(t){"undefined"!=typeof t.m?alert(t.m):$.each(t,function(t,r){var d=n.parent().parent().index(),l=document.getElementById(e).getElementsByTagName("tbody")[0],c=l.insertRow(d+1);c.id=i+d,uniqId=a+""+d+t,uniqIdCheck=a+""+d+t+"check";var s=c.insertCell(0),p=c.insertCell(1),u=c.insertCell(2),m=c.insertCell(3);s.innerHTML="N. Serie: <input type='text' class='"+uniqId+" form-control n' name='nserie' value='"+r.num_serie+"' readonly>",p.innerHTML="Motivo: <input type='text' class='"+uniqId+" form-control m' name='motivo'>",p.colSpan=3,u.innerHTML="<input id='"+uniqIdCheck+"' type='checkbox' name='vehicle' value='rmaCheck'>",m.innerHTML="<input onclick='btnRmaEnviar(this)' type='button' value='Enviar' id='"+uniqId+"' data-idfoliopedido='"+a+"' data-referencia='"+i+"' data-cantidad='"+o+"' data-idfoliopedidoweb='"+r.folio_pedido+"' data-foliocompra='"+r.folio_compra+"'>"})},error:function(e,t,a){alert("Ha ocurrido un error, intente más tarde")}})}function btnRmaEnviar(e){var t=$(e).attr("id"),a="#"+$(e).attr("id")+"check";if($(a).is(":checked")){var i="."+t+".form-control.m";if(""!=$(i).val()){var o=$(e).data("idfoliopedido"),n=$(e).data("referencia"),r=$(e).data("cantidad"),d=$(e).data("idfoliopedidoweb"),l=$(e).data("foliocompra"),c=$(e);uniqIdNserie="."+t+".form-control.n";var s=$(uniqIdNserie).val(),p=$(i).val();$.ajax({type:"POST",data:{cliente:clienteIdPrestashop,idFolioPedido:o,referencia:n,valNserie:s,valMotivo:p,cantidad:r,idfoliopedidoweb:d,foliocompra:l},url:window.location.origin+"/yiiNsstore/index.php?r=rmasYii/solicitarRma",dataType:"json",encoding:"UTF-8",cache:!1,beforeSend:function(){$(".loadingmessage").show()},success:function(e){$(".loadingmessage").hide(),alert(e.m),c.attr("disabled",!0)},error:function(e,t,a){alert("Ha ocurrido un error, intente más tarde")}})}else alert("El campo motivo es requerido")}else alert("Debe habilitar el cuadro de selección para poder enviar el RMA")}$(document).ready(function(){$(".btnFancyLinea").fancybox({autoSize:!1}),$(".btnFancyPiso").fancybox({autoSize:!1}),$.datepicker.regional.es={closeText:"Cerrar",prevText:"< Ant",nextText:"Sig >",currentText:"Hoy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Juv","Vie","Sáb"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sá"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},$.datepicker.setDefaults($.datepicker.regional.es),clienteIdPrestashop=$("#id_cliente").attr("value");var e=function(e){jsGrid.Field.call(this,e)};e.prototype=new jsGrid.Field({filterTemplate:function(){var e=new Date;return this._fromPicker=$("<input placeholder='Desde'>").datepicker({defaultDate:e.setFullYear(e.getFullYear()-1),dateFormat:"dd-mm-yy"}),this._toPicker=$("<input placeholder='Hasta'>").datepicker({defaultDate:e.setFullYear(e.getFullYear()-1),dateFormat:"dd-mm-yy"}),$("<div>").append(this._fromPicker).append(this._toPicker)},filterValue:function(e){return{f:this._fromPicker.datepicker("getDate"),to:this._toPicker.datepicker("getDate")}},itemTemplate:function(e){return date=new Date(e),month=(date.getMonth()+1).toString(),month=month.length>1?month:"0"+month,day=date.getDate().toString(),day=day.length>1?day:"0"+day,day+"-"+month+"-"+date.getFullYear()}}),jsGrid.fields.date_type=e;var t=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasPiso";jsGrid.locale("es"),$("#pedidos_piso").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(e){return $.ajax({type:"POST",dataType:"json",url:t,data:{datos:e,cliente:clienteIdPrestashop}})}},fields:[{name:"pd-folio_pedido",type:"text",title:"Folio Pedido"},{name:"pd-fecha",type:"date_type",title:"Fecha"},{name:"pd-surtido",type:"text",title:"Estado"},{name:"fp-folio_factura_electronica",type:"text",title:"No. Factura"},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]});var a=window.location.origin+"/yiiNsstore/index.php?r=pedidosFacturaYii/consultarPedidosFacturasLinea";$("#pedidos_enlinea").jsGrid({height:"auto",width:"100%",sorting:!0,paging:!0,autoload:!0,pageSize:10,pageButtonCount:5,filtering:!0,controller:{loadData:function(e){return $.ajax({type:"POST",dataType:"json",url:a,data:{datos:e,cliente:clienteIdPrestashop}})}},fields:[{name:"o-reference",type:"text",title:"Folio Pedido"},{name:"o-date_add",type:"date_type",title:"Fecha"},{name:"o-payment",type:"text",title:"Pago"},{name:"estado",type:"text",title:"Estado",width:250,filtering:!1},{name:"detalle",type:"text",title:"Detalle",filtering:!1},{name:"ordenar",type:"text",title:"Ordenar",filtering:!1},{name:"xml",type:"text",title:"XML",filtering:!1},{name:"pdf",type:"text",title:"PDF",filtering:!1},{type:"control",editButton:!1,deleteButton:!1,modeSwitchButton:!1}]})});